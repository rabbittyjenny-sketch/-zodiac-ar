<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zodiac AR Hologram</title>
    <style>
        body {
            margin: 0;
            background: #000;
            color: #fff;
            font-family: sans-serif;
            overflow: hidden;
        }

        #ar-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        video {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 80%;
            max-height: 80%;
            border: 2px solid #fff;
            border-radius: 10px;
            box-shadow: 0 0 30px cyan;
            filter: drop-shadow(0 0 20px cyan) contrast(1.2) brightness(1.1);
        }

        img {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid cyan;
            box-shadow: 0 0 20px cyan;
        }

        p {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 18px;
            color: cyan;
            text-shadow: 0 0 10px #0ff;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: cyan;
            text-shadow: 0 0 10px #0ff;
        }

        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            color: #ff6b6b;
            text-align: center;
            padding: 20px;
            border: 2px solid #ff6b6b;
            border-radius: 10px;
            background: rgba(255, 107, 107, 0.1);
        }

        .zodiac-title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 32px;
            color: cyan;
            text-shadow: 0 0 15px #0ff;
            font-weight: bold;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <div id="ar-container">
        <div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏®‡∏µ...</div>
    </div>

    <script>
        window.onload = async () => {
            try {
                // 1Ô∏è‚É£ ‡∏≠‡πà‡∏≤‡∏ô‡∏£‡∏≤‡∏®‡∏µ‡∏à‡∏≤‡∏Å URL
                const urlParams = new URLSearchParams(window.location.search);
                const zodiacSign = urlParams.get('sign');

                if (!zodiacSign) {
                    throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏®‡∏µ‡πÉ‡∏ô URL ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° ?sign=‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏®‡∏µ");
                }

                // 2Ô∏è‚É£ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Apps Script Web App ‡πÉ‡∏´‡∏°‡πà
                const sheetWebAppUrl = "https://script.google.com/macros/s/AKfycbxy4JEl08gMH0KwjIxuwj3P8uwuFnZ5KE-ovKUsWdxkt1bNp-1giCKQYGgXIFEDRKt2Ew/exec";

                const res = await fetch(`${sheetWebAppUrl}?sign=${zodiacSign}`);

                if (!res.ok) {
                    throw new Error(`HTTP Error: ${res.status} - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ`);
                }

                const rowData = await res.json();

                if (rowData.error) {
                    throw new Error(rowData.error);
                }

                if (!rowData || !rowData.zodiac_sign) {
                    throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏®‡∏µ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö");
                }

                const container = document.getElementById('ar-container');
                container.innerHTML = ''; // ‡∏•‡∏ö loading message

                // 3Ô∏è‚É£ ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏®‡∏µ
                if (rowData.zodiac_sign) {
                    const titleEl = document.createElement('div');
                    titleEl.className = 'zodiac-title';
                    titleEl.textContent = rowData.zodiac_sign;
                    container.appendChild(titleEl);
                }

                // 4Ô∏è‚É£ Video Hologram
                if (rowData.video_url && rowData.video_url.trim() !== '') {
                    const videoEl = document.createElement('video');
                    videoEl.src = rowData.video_url;
                    videoEl.autoplay = true;
                    videoEl.loop = true;
                    videoEl.muted = true; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô muted ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ autoplay ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
                    videoEl.controls = true;
                    videoEl.playsInline = true; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠

                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
                    videoEl.addEventListener('loadeddata', () => {
                        console.log('Video loaded successfully');
                    });

                    videoEl.addEventListener('error', (e) => {
                        console.error('Video loading error:', e);
                    });

                    container.appendChild(videoEl);
                }

                // 5Ô∏è‚É£ Stone image overlay
                if (rowData.stone_image && rowData.stone_image.trim() !== '') {
                    const imgEl = document.createElement('img');
                    imgEl.src = rowData.stone_image;
                    imgEl.alt = `${rowData.zodiac_sign} Stone`;

                    imgEl.addEventListener('error', () => {
                        imgEl.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
                    });

                    container.appendChild(imgEl);
                }

                // 6Ô∏è‚É£ Message
                if (rowData.message && rowData.message.trim() !== '') {
                    const msgEl = document.createElement('p');
                    msgEl.textContent = rowData.message;
                    container.appendChild(msgEl);
                }

                console.log('AR Zodiac loaded successfully:', rowData);

            } catch (error) {
                console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
                const container = document.getElementById('ar-container');
                container.innerHTML = `
                    <div class="error">
                        <h3>üö´ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                        <p>${error.message}</p>
                        <p><small>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï ‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</small></p>
                    </div>
                `;
            }
        };
    </script>
</body>
</html>
